<!--
    Author: Devin Eldreth
    Multigraph Development Team
    October 27, 2008
    
    This file is an example of a situational use for Multigraph. The primary purpose of this file/excerise
    was to demonstrate Multigraph's usefullness with known GIS applications such as OpenLayers. 
    
    This application also uses an open source draggable div API provided by the guys at jstool.googlecode.com. 
    A big thanks to their awesome work with DHTML.

    Each draggable div, in this example, houses one Multigraph (SVG) graph.

    Markers are placed at known weather station positions to indicate that the user has the ability to 'pull up'
    a graph of data from that location.
    
    At the moment the graphs are all the same. 
    
    Important Usage Information:
        Though OpenLayers and jsTool are not browser specific, Multigraph currently only supports SVG rendering.
	So Firefox for Safari or some other non-VML browser must be used to properly view the graph objects.
    
    Important links used in developing this file:
    http://www.openlayers.org
    http://www.multigraph.org
    http://jstool.googlecode.com
-->

<html xmlns="http://www.w3.org/1999/xhtml" debug="true">
  <head>
    <style type="text/css">
        body {
	    margin: 0px;
	    padding: 0px;
	} 
        #map {
	    position:absolute;
            border: 1px solid black;
            background-color: blue;
        }

	.container
	{
	    background-color: #FFFFFF;
	    border: 1px solid #222222;
	    border-bottom: 1px solid #222222;	
	    float: left;
	    z-index:10000;
	}

	.handle
	{
	    display: block;
	    background-color: #999999;
	    border: 2px solid #777777;
	    color: white;
	    height:16px;
	    font-size:10pt;
	}
	
	.closeBox
	{
	    position: absolute;
	    top: 2;
	    right: 2;
	    width: 14px;
	    height: 14px;
	    color: #000000;
	    float: right;
	    background-color: red;
	    border: .5px solid #000000;
	}

	.item
	{
	    float: left; /** very important **/
	    display: block; /** very important **/
	    border: medium solid #91c7ed;
	    background-color: #8d9ac4;
	    width: 60px;
	    height: 60px;
	}

	.item span
	{
	    margin-left: 4px;
	    margin-right: 4px;
	    color: white;
	}

	.description
	{
	    width: 600px;
	    color: #f6b9d4;
	    background-color: #a46b84;
	    border: thick solid #852550;
	    float: none !important;
	}

	.description p
	{
	    font-size: medium;
	    margin-left: 1em;
	}

	.description p:first-letter
	{
	    font-size: 30px;
	    font-style: oblique;
	    color: #f9e4ed;
	    font-variant: small-caps;
	}

	#boxDrag, #boxVerticalOnly, #boxHorizontalOnly, #boxRegionConstraint, #boxThreshold, #boxAbsolute, #map 
	{
	    cursor: move;
	}
    </style>

    <script src="./openlayers/lib/OpenLayers.js"></script>
    <script src="../../Multigraph.js"</script>

    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAALaX1UBpenstH0b6X05a3RRSP6dTan0wbxYiw5gLCPNnvpaZkwRTmT9ZwjeO2uL-wDYd_hIagilFOAA"
      type="text/javascript"></script>

    <!-- ToolMan components -->
    <script type="text/javascript" src="jstool/ToolMan/core.js"></script>
    <script type="text/javascript" src="jstool/ToolMan/css.js"></script>
    <script type="text/javascript" src="jstool/ToolMan/coordinates.js"></script>
    <script type="text/javascript" src="jstool/ToolMan/events.js"></script>
    <script type="text/javascript" src="jstool/ToolMan/drag.js"></script>
    <script type="text/javascript" src="jstool/ToolMan/cookies.js"></script>

    <!-- jsTool components -->
    <script type="text/javascript" src="jstool/jsTool/core.js"></script>
    <script type="text/javascript" src="jstool/jsTool/intersection.js"></script>
    <script type="text/javascript" src="jstool/jsTool/raise.js"></script>
    <script type="text/javascript" src="jstool/jsTool/container.js"></script>
    <script type="text/javascript" src="jstool/jsTool/swap.js"></script>
    <script type="text/javascript" src="jstool/jsTool/test.js"></script>

    <script>
        var map, layer, markers;
	var popups = new Array();
var stations = [
    [1141,        'FL Titusville 7 E',        -80.6929,       28.6159],
    [1120,        'GA Brunswick 23 S',        -81.4596,       30.8078],
    [1033,        'GA Newton 11 SW',          -84.4465,       31.1923],
    [1032,        'GA Newton 8 W',            -84.4706,       31.3127],
    [1111,        'GA Watkinsville 5 SSE',    -83.3896,       33.7837],
    [1186,        'HI Hilo 5 S',              -155.0827,      19.6450],
    [1187,        'HI Mauna Loa 5 NNE',       -155.5760,      19.5354],
    [1116,        'IA Des Moines 17 E',       -93.2855,       41.5562],
    [1021,        'ID Arco 17 SW',            -113.5560,      43.4621],
    [1022,        'ID Murphy 10 W',           -116.7505,      43.2044],
    [1037,        'IL Champaign 9 SW',        -88.3729,       40.0528],
    [1038,        'IL Shabbona 5 NNE',        -88.8513,       41.8430],
    [1510,        'IN Bedford 5 WNW',         -86.5707,       38.8882],
    [1047,        'KS Manhattan 6 SSW',       -96.6098,       39.1027],
    [1231,        'KS Oakley 19 SSW',         -100.9627,      38.8701],
    [1031,        'KY Bowling Green 21 NNE',  -86.2325,       37.2504],
    [1028,        'KY Versailles 3 NNW',      -84.7465,       38.0945],
    [1013,        'LA Lafayette 13 SE',       -91.8731,       30.0918],
    [1012,        'LA Monroe 26 N',           -92.1165,       32.8833],
    [1035,        'ME Limestone 4 NNW',       -67.8833,       46.9601],
    [1034,        'ME Old Town 2 W',          -68.7006,       44.9281],
    [1113,        'MI Chatham 1 SE',          -86.9200,       46.3345],
    [1426,        'MI Gaylord 9 SSW',         -84.7203,       44.9080],
    [1039,        'MN Goodridge 12 NNW',      -95.8744,       48.3055],
    [1447,        'MN Sandstone 6 W',         -92.9936,       46.1135],
    [1142,        'MO Chillicothe 22 ENE',    -93.1470,       39.8668],
    [1407,        'MO Joplin 24 N',           -94.5829,       37.4277],
    [1406,        'MO Salem 10 W',            -91.7226,       37.6344],
    [1570,        'MS Holly Springs 4 N',     -89.4348,       34.8223],
    [1036,        'MS Newton 5 ENE',          -89.0703,       32.3378],
    [1468,        'MT Dillon 18 WSW',         -113.0057,      45.1580],
    [1612,        'MT Lewistown 42 WSW',      -110.2895,      46.8847],
    [1046,        'MT St. Mary 1 SSW',        -113.4330,      48.7412],
    [1001,        'MT Wolf Point 29 ENE',     -105.1018,      48.3082],
    [1002,        'MT Wolf Point 34 NE',      -105.2096,      48.4887],
    [1027,        'NC Asheville 13 S',        -82.5567,       35.4185],
    [1026,        'NC Asheville 8 SSW',       -82.6142,       35.4945],
    [1347,        'NC Durham 11 W',           -79.0931,       35.9705],
    [1611,        'ND Jamestown 38 WSW',      -99.4778,       46.7702],
    [1139,        'ND Medora 7 E',            -103.3769,      46.8946],
    [1235,        'ND Northgate 5 ESE',       -102.1702,      48.9676],
    [1025,        'NE Harrison 20 SSE',       -103.7358,      42.4248],
    [1003,        'NE Lincoln 11 SW',         -96.8541,       40.6954],
    [1004,        'NE Lincoln 8 ENE',         -96.5651,       40.8484],
    [1115,        'NE Whitman 5 ENE',         -101.4450,      42.0680],
    [1041,        'NH Durham 2 N',            -70.9277,       43.1716],
    [1040,        'NH Durham 2 SSW',          -70.9484,       43.1092],
    [1307,        'NM Las Cruces 20 N',       -106.7414,      32.6137],
    [1138,        'NM Los Alamos 13 W',       -106.5214,      35.8584],
    [1020,        'NM Socorro 20 N',          -106.8859,      34.3557],
    [1106,        'NV Baker 5 W',             -114.2090,      39.0118],
    [1532,        'NV Denio 52 WSW',          -119.6357,      41.8484],
    [1049,        'NV Mercury 3 SSW',         -116.0225,      36.6240],
    [1117,        'NY Ithaca 13 E',           -76.2462,       42.4401],
    [1118,        'NY Millbrook 3 W',         -73.7422,       41.7857],
    [1125,        'OH Coshocton 8 NNE',       -81.7829,       40.3667],
    [1068,        'OK Goodwell 2 E',          -101.5950,      36.5993],
    [1005,        'OK Stillwater 2 W',        -97.0914,       36.1181],
    [1006,        'OK Stillwater 5 WNW',      -97.1082,       36.1346],
    [1112,        'ON Egbert 1 W',            -79.7810,       44.2326],
    [1610,        'OR Coos Bay 8 SW',         -124.3186,      43.2718],
    [1234,        'OR Corvallis 10 SSW',      -123.3257,      44.4185],
    [1145,        'OR John Day 35 WNW',       -119.6459,      44.5560],
    [1023,        'OR Riley 10 WSW',          -119.6917,      43.4711],
    [1123,        'PA Avondale 2 N',          -75.7861,       39.8593],
    [1042,        'RI Kingston 1 NW',         -71.5413,       41.4911],
    [1043,        'RI Kingston 1 W',          -71.5417,       41.4782],
    [1029,        'SC Blackville 3 W',        -81.3279,       33.3550],
    [1030,        'SC McClellanville 7 NE',   -79.3637,       33.1532],
    [1446,        'SD Aberdeen 35 WNW',       -99.12958,      45.71145],
    [1140,        'SD Buffalo 13 ESE',        -103.3017,      45.5160],
    [1236,        'SD Pierre 24 S',           -100.3530,      44.0194],
    [1009,        'SD Sioux Falls 14 NNE',    -96.6222,       43.7346],
    [1121,        'TN Crossville 7 NW',       -85.1345,       36.0138],
    [1147,        'TN Oakridge 0 N',          -84.249,        36.003],
    [1386,        'TX Austin 33 NW',          -98.0846,       30.6222],
    [1130,        'TX Bronte 11 NNE',         -100.2495,      32.0408],
    [1066,        'TX Edinburg 17 NNE',       -98.0633,       26.5258],
    [1019,        'TX Monahans 6 ENE',        -102.8071,      31.6219],
    [1067,        'TX Muleshoe 19 S',         -102.7740,      33.9557],
    [1018,        'TX Palestine 6 WNW',       -95.7232,       31.7796],
    [1306,        'TX Panther Junction 2 N',  -103.2093,      29.3483],
    [1387,        'TX Port Aransas 32 NNE',   -96.8230,       28.3045],
    [1507,        'UT Brigham City 28 WNW',   -112.5437,      41.6163],
    [1509,        'UT Torrey 7 E',            -111.2935,      38.3028],
    [1085,        'VA Cape Charles 5 ENE',    -75.9270,       37.2907],
    [1346,        'VA Charlottesville 2 SSE', -78.4656,       37.9975],
    [1305,        'VA Sterling 0 N',          -77.48765,      38.97245],
    [1017,        'WA Darrington 21 NNE',     -121.4460,      48.5405],
    [1233,        'WA Quinault 4 NE',         -123.8120,      47.5139],
    [1467,        'WA Spokane 17 SSW',        -117.5264,      47.4174],
    [1114,        'WI Necedah 5 WNW',         -90.1737,       44.0604],
    [1024,        'WV Elkins 21 ENE',         -79.4743,       39.0130],
    [1144,        'WY Lander 11 SSE',         -108.6686,      42.6754],
    [1107,        'WY Moose 1 NNE',           -110.7120,      43.6615],
    [1487,        'WY Sundance 8 NNW',        -104.4363,      44.5169],
    [1007,        'AK Barrow 4 ENE',          -156.6110,      71.3213],
    [1008,        'AK Fairbanks 11 NE',       -147.5100,      64.9735],
    [1166,        'AK Sitka 1 NE',            -135.3266,      57.0574],
    [1143,        'AK St. Paul 4 NE',         -170.2119,      57.1575],
    [1550,        'AL Brewton 0 N',           -87.0518,       31.1449],
    [1326,        'AL Clanton 0 N',           -86.6115,       32.8516],
    [1268,        'AL Courtland 0 N',         -87.3462,       34.6602],
    [1267,        'AL Cullman 0 N',           -86.7963,       34.1954],
    [1124,        'AL Fairhope 3 NE',         -87.8757,       30.5485],
    [1119,        'AL Gadsden 19 N',          -85.9621,       34.2851],
    [1327,        'AL Gainesville 0 N',       -88.1374,       32.8369],
    [1328,        'AL Greensboro 0 N',        -87.6226,       32.7169],
    [1269,        'AL Guntersville 0 N',      -86.3156,       34.3337],
    [1366,        'AL Muscle Shoals 0 N',     -87.6399,       34.7728],
    [1297,        'AL Russellville 0 N',      -87.7104,       34.4535],
    [1296,        'AL Scottsboro 0 N',        -85.9998,       34.6941],
    [1329,        'AL Selma 0 N',             -86.9787,       32.3349],
    [1122,        'AL Selma 13 WNW',          -87.2422,       32.4567],
    [1551,        'AL Thomasville 0 N',       -87.7367,       31.8814],
    [1552,        'AL Troy 0 N',              -86.0004,       31.7901],
    [1266,        'AL Valley Head 0 N',       -85.6171,       34.5653],
    [1129,        'AR Batesville 8 WNW',      -91.7812,       35.8201],
    [1010,        'AZ Elgin 5 S',             -110.5087,      31.5907],
    [1011,        'AZ Tucson 11 W',           -111.1696,      32.2395],
    [1613,        'AZ Williams 35 NNW',       -112.3374,      35.7552],
    [1590,        'AZ Yuma 27 ENE',           -114.1884,      32.8350],
    [1531,        'CA Bodega 6 WSW',          -123.0747,      38.3208],
    [1528,        'CA Fallbrook 5 NE',        -117.1904,      33.4392],
    [1050,        'CA Merced 23 WSW',         -120.8825,      37.2381],
    [1015,        'CA Redding 12 WNW',        -122.6068,      40.6507],
    [1529,        'CA Santa Barbara 11 W',    -119.8796,      34.4141],
    [1105,        'CA Stovepipe Wells 1 SW',  -117.1449,      36.6020],
    [1508,        'CA Yosemite Village 12 W', -119.8208,      37.7592],
    [1045,        'CO Boulder 14 W',          -105.5409,      40.0354],
    [1232,        'CO Cortez 8 SE',           -108.5035,      37.2553],
    [1108,        'CO Dinosaur 2 E',          -108.9677,      40.2446],
    [1110,        'CO La Junta 17 WSW',       -103.8224,      37.8639],
    [1109,        'CO Montrose 11 ENE',       -107.6928,      38.5440],
    [1014,        'CO Nunn 7 NNE',            -104.7552,      40.8066],
    [1128,        'FL Everglades City 5 NE',  -81.3184,       25.8996],
    [1530,        'FL Sebring 23 SSE',        -81.3689,       27.1526]
];
        
	// Default graph width and height
	var defaultWidth  = 600;
	var defaultHeight = 200;

        AutoSizeAnchored = OpenLayers.Class(OpenLayers.Popup.Anchored, {
            'autoSize': true,
	    'minSize': new OpenLayers.Size(310,310)
        });
	
	AutoSizeFramedCloud = OpenLayers.Class(OpenLayers.Popup.FramedCloud, {
            'autoSize': true, 
            'minSize': new OpenLayers.Size(320,280)
        });
	
       	    var options = {
                projection: new OpenLayers.Projection("EPSG:900913"),
                units: "m",
                maxResolution: 0.703125,
                maxExtent: new OpenLayers.Bounds(-20037508.34, -20037508.34,
                                                 20037508.34, 20037508.34)
            };
       var points = new Array();
       var lineFeature = new Array();
       var vectorLayer = new OpenLayers.Layer.Vector("Lines");
       var style_red = {
           strokeColor: "red",
           strokeOpacity: 1,
           strokeWidth: 3,
           pointRadius: 6,
           pointerEvents: "visiblePainted"
       };
       
       function init(){
            // Set div sizes
	    var docHeight = document.body.clientHeight - 10;
	    var docWidth = document.body.clientWidth - 10;

	    document.getElementById("map").style.height = docHeight;
	    document.getElementById("map").style.width = docWidth;
	    document.getElementById("hover").style.height = docHeight;
	    document.getElementById("hover").style.width = docWidth;
	    
            // Create a new map
            map = new OpenLayers.Map('map');

	    // Standard vector and satellite maps
	    var ol_wms = new OpenLayers.Layer.WMS(
                "OpenLayers WMS",
                "http://labs.metacarta.com/wms/vmap0",
                {layers: 'basic'}
            );
	    map.addLayer(ol_wms);

            var jpl_wms = new OpenLayers.Layer.WMS( 
	        "Satellite",
                "http://labs.metacarta.com/wms-c/Basic.py?",
	        {layers: 'satellite'} 
	    );
	    map.addLayer(jpl_wms);
	    
	    var goog = new OpenLayers.Layer.Google("Google Maps", options);
	    map.addLayer(goog);

	    // Add the lines vector layer
            map.addLayer(vectorLayer);

	    // Create the stations layer, add the layer to the map, and then add the stations
	    markers = new OpenLayers.Layer.Markers("Stations");
            map.addLayer(markers);

            map.addControl(new OpenLayers.Control.LayerSwitcher());

	    map.setCenter(new OpenLayers.LonLat(-97.0, 38.0));
	    map.zoomTo(4);

	    // Add event listeners for zoom and pan endings	    
	    map.events.register("zoomend", map, updateLines);	    
	    map.events.register("move", map, updateLines);
	    
	    addStations();
        }

	function updateLines() {
	    for (var container in lineFeature) {
	        if(lineFeature[container] != null) {
	            vectorLayer.destroyFeatures([lineFeature[container]]);
		    div = document.getElementById(container);
		    points[container].pop();
		    var xy = new OpenLayers.Pixel(div.style.left, div.style.top);
		    points[container].push(new OpenLayers.Geometry.Point(map.getLonLatFromPixel(xy).lon, map.getLonLatFromPixel(xy).lat));
		    lineFeature[container] = new OpenLayers.Feature.Vector(
		        new OpenLayers.Geometry.LineString(points[container]),null,style_red);

		    vectorLayer.addFeatures([lineFeature[container]]);
		}
	    }
	}
	
	// Adds each marker for a station and returns the total number of stations (markers)
	function addStations() {
	    var c = 1;

	    for(x = 0; x < stations.length; x++) {
	        var ll = new OpenLayers.LonLat(stations[x][2], stations[x][3])
	        addMarker([ll, stations[x][0]], stations[x][1], c);
		c++;
	    }
	}	

        function addMarker(/** Array */ stationIdentifier, /** String */ popupContentHTML, /** int */ container) {
            var feature = new OpenLayers.Feature(layer, stationIdentifier[0]);                     
            var marker = feature.createMarker();
	    
	    // Event handler for marker clicking
            var markerClick = function (evt) {
	        createPopupGraph(container, stationIdentifier[1], popupContentHTML);
	        
		// Add modality to individual div
		var drag2cs = Tool.drag2container();
		var	drag = ToolMan.drag();
		var raise = Tool.raise();
		var coordinates = ToolMan.coordinates();
	        
		var handle = document.getElementById("h" + container);
		
		var boxToConstrain = document.getElementById('c' + container);
		var boxThatConstrains = document.getElementById("hover");

	        // Setup a contraining box to keep the popups within a specific region
	        var group = drag.createSimpleGroup(boxToConstrain, handle);
	        var origin = coordinates.create(parseInt(boxThatConstrains.style.width) - defaultWidth, 
					parseInt(boxThatConstrains.style.height) - defaultHeight - 16);
		
	        group.addTransform(function(coordinate, dragEvent) {
	            var originalTopLeftOffset = dragEvent.topLeftOffset.minus(dragEvent.topLeftPosition);		    

		    var thisElement = dragEvent.group.element.getAttribute("id");
		    //alert(thisElement);
		    if(points[thisElement].length > 1) {
		        // since this is a straight line always remove the last point added
		        points[thisElement].pop();
			
			// REQUIRED -- always pass arrays to this function, not doing so produces weird (but working) results
			vectorLayer.destroyFeatures([lineFeature[thisElement]]);
		    }
		    
		    points[thisElement].push(new OpenLayers.Geometry.Point(map.getLonLatFromPixel(dragEvent.topLeftPosition).lon, 
			                                                   map.getLonLatFromPixel(dragEvent.topLeftPosition).lat));
	    	    lineFeature[thisElement] = new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(points[thisElement]),null,this.style_red);
		    vectorLayer.addFeatures([lineFeature[thisElement]]);		    
		    return coordinate.constrainTo(origin, originalTopLeftOffset);
	        });
		
		var popup = document.getElementById('c' + container);
		x = map.getPixelFromLonLat(stationIdentifier[0]).x;
		y = map.getPixelFromLonLat(stationIdentifier[0]).y;

		// Set the popup's position to be that of the transformed ll coordinates
		popup.style.left = x;
		popup.style.top = y;
		popup.style.width = defaultWidth;
		popup.style.height = defaultHeight;

		// toggle the visibility of the popup
		if (popup.style.visibility == 'visible') {
		    //Multigraph.Graph.destroyInstance('g'+container);
		    MultigraphDelete('graphdiv'+container);
		    vectorLayer.destroyFeatures([lineFeature["c" + container]]);
		    removeDiv(container);
		}
		else {
		    // This is a hack!!
		    popup.style.visibility = 'visible';
		    var object = document.getElementById("object:" + container);		    
		    //var mugl = "http://www.multigraph.org/examples/crnmap/crngraphxml.php/"+ stationIdentifier[1] +"/T5,P5,SOLARAD,WINDSPD,SUR_TEMP";
		    var mugl = "http://www.multigraph.org/examples/crnmap/crngraphxml.php/"+ stationIdentifier[1] +"/T5,P5";
		    //var mugl = "tempgraph.xml";
/*
		    var embed = document.getElementById("embed:" + container);
		    embed.setAttribute("flashVars", "muglfile="+mugl);
		    embed.setAttribute("src","ASGraphicsTest.swf");
*/
            new Multigraph("graphdiv"+container, mugl, [defaultWidth,defaultHeight]);
		    //object.appendChild(embed);

		    startLine(stationIdentifier[0], container);
		}
            }
	    
            marker.events.register("mousedown", feature, markerClick);
            markers.addMarker(marker);
        }
		
	// Create a new popup div and graph
	// name - The name of the div, this will usually be a number
	// data - name of the linked Multigraph xml file or data
	function createPopupGraph (container, data, title) {
	    var popup = document.createElement("div");
	    popup.setAttribute("id", "c" + container);
	    popup.setAttribute("class", "container");
	    popup.style.position = "absolute";
	    popup.style.visibility = "hidden";

	    var handle = document.createElement("div");
	    handle.setAttribute("id", "h" + container);
	    handle.setAttribute("class", "handle");
	    handle.innerHTML = title;
	    
	    // Create and append a box that symbolizes an X box
	    var closeBox = document.createElement("div");
	    closeBox.setAttribute("id", "close" + container);
	    closeBox.setAttribute("class", "closeBox");
	    closeBox.align = "center";
	    closeBox.innerHTML = "X";
	    handle.appendChild(closeBox);

/*
	    var object = document.createElement("object");
	    object.setAttribute("id", "object:"+container);
	    var embed  = document.createElement("embed");
	    embed.setAttribute("quality", "high");
	    embed.setAttribute("width", defaultWidth);
	    embed.setAttribute("height", defaultHeight - 18);
	    embed.setAttribute("id", "embed:" + container);
	    object.appendChild(embed);
*/
	    var graphdiv = document.createElement("div");
        graphdiv.setAttribute("id", "graphdiv"+container);

	    popup.appendChild(handle);
/*
	    popup.appendChild(object);
*/
	    popup.appendChild(graphdiv);
	    document.getElementById('hover').appendChild(popup);

	    // Add the event listener to close the popup if the top right 'closing box' is clicked
	    closeBox.addEventListener("mousedown", function (evt) {
		//Multigraph.Graph.destroyInstance('g'+name);
		MultigraphDelete('graphdiv'+container);
		vectorLayer.destroyFeatures([lineFeature["c" + container]]);
		removeDiv(container);
	    }, false);

	    return popup;
	}
	
	function startLine(ll, container) {
	    points["c" + container] = new Array();
	    
	    // Push the same point twice so if the map moves before the graph the line renders properly
	    points["c" + container].push(new OpenLayers.Geometry.Point(ll.lon, ll.lat));
	    points["c" + container].push(new OpenLayers.Geometry.Point(ll.lon, ll.lat));	    
	    lineFeature["c" + container] = new OpenLayers.Feature.Vector(
	        new OpenLayers.Geometry.LineString(points["c" + container]),null,style_red);

            vectorLayer.addFeatures([lineFeature["c" + container]]);
	}

	function removeDiv(container) {
	    var hover = document.getElementById("hover");
	    hover.removeChild(document.getElementById("c" + container));
	    lineFeature["c" + container] = null;
	}	

	function ModalGraph() {
	    this.popup = null;
	    this.line = null;
	    this.x = 0;
	    this.y = 0;
	    this.lon = 0;
	    this.lat = 0;
	    
	    this.init = function(div) {
	        this.popup = div;
		this.x = this.popup.style.left;
		this.y = this.popup.style.top;
	    }
	}
    </script>
  </head>
  
  <body onload="init()">
<table width="100%" border="1">
<tr><td align="center">
<b>CRN Interactive Map Demo</b>
<br>
"F11, Ctrl-R" toggles full-screen mode.
Click on a station to bring up graph.
Hold shift key to zoom time axis.
</td></tr>
<tr><td>
    <div id="map" style="position:absolute;"></div>
    <div id="lines" style="position:absolute; z-index:100;"></div>
    <div id="hover" style="position:absolute;"></div>
    <div id="msg3" style="position:absolute; top:500px; color:#FFFFFF; background-color:#000000;"></div>
</td></tr>
</table>
  </body>
<html>
